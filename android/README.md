# Прием данных с Bluetooth HC-05 на Android

Это Android-приложение демонстрирует, как принимать данные с Bluetooth-модуля HC-05 и отображать их на экране. Это базовый пример, и может потребоваться корректировка в зависимости от вашей конкретной конфигурации HC-05 и формата данных.

## ✏️ Функциональность

Приложение выполняет следующие действия:

1. **Проверка разрешений Bluetooth**: Проверяет наличие необходимых разрешений (BLUETOOTH, BLUETOOTH_ADMIN, ACCESS_FINE_LOCATION, ACCESS_COARSE_LOCATION). Если разрешения отсутствуют, запрашивает их у пользователя. Обратите внимание, что ACCESS_FINE_LOCATION часто требуется для сканирования Bluetooth-устройств на новых версиях Android.

2. **Подключение к HC-05**: Пытается подключиться к Bluetooth-модулю HC-05, используя его MAC-адрес (замените "XX:XX:XX:XX:XX:XX" на ваш реальный MAC-адрес HC-05). Используется UUID для сервиса Serial Port Profile (SPP), обычно используемого модулями HC-05.

3. **Прием и отображение данных**: После подключения фоновый поток непрерывно считывает данные из входного потока (inputStream) сокета. Полученные данные (которые должны быть текстом) затем отображаются в TextView на основном потоке UI с помощью Handler для обеспечения безопасности потоков.

4. **Обработка ошибок**: Включает блоки try-catch для обработки возможных исключений IOException во время подключения и чтения данных, отображая информативные сообщения об ошибках пользователю.

5. **Архитектура ViewModel**: Использует ViewModel (MainViewModel) для управления логикой подключения Bluetooth и обработки данных отдельно от Activity. Это улучшает организацию кода, тестируемость и делает приложение более надежным. ViewModel управляет жизненным циклом подключения и обработки данных, гарантируя правильное освобождение ресурсов.

6. **Управление жизненным циклом**: Activity обрабатывает события жизненного цикла (onCreate, onDestroy), гарантируя, что соединение Bluetooth устанавливается в onCreate() и закрывается в onDestroy(). ViewModel также управляет своим собственным жизненным циклом, освобождая ресурсы, когда он больше не нужен.

## ✏️ Структура кода

Проект содержит следующие ключевые файлы:

- **AndroidManifest.xml**: Объявляет необходимые разрешения Bluetooth.
- **build.gradle**: Указывает зависимости проекта, включая библиотеку androidx.bluetooth:bluetooth-connectivity для работы с Bluetooth и другие необходимые библиотеки.
- **MainActivity.kt**: Основной Android Activity. Обрабатывает взаимодействие с пользователем, запросы разрешений и взаимодействует с ViewModel.
- **activity_main.xml**: Файл макета, определяющий пользовательский интерфейс (простой TextView для отображения полученных данных).
- **MainViewModel.kt**: Класс ViewModel, который инкапсулирует логику подключения Bluetooth и обработки данных, отделяя её от UI.

## ✏️ Подробное объяснение логики

MainViewModel играет центральную роль в логике приложения:

1. **connect()**: Эта функция пытается создать сокет RFCOMM, используя предоставленный объект BluetoothDevice. Обработка ошибок включена для перехвата исключений во время создания сокета и подключения.

2. **startListening()**: Эта функция работает во фоновом потоке, непрерывно считывая данные из inputStream подключенного сокета. Прочитанные данные затем отправляются в основной поток с помощью Handler для обновления UI, обеспечивая безопасность потоков.

3. **onCleared()**: Эта функция вызывается при уничтожении ViewModel и закрывает Bluetooth-сокет для освобождения ресурсов.

MainActivity обрабатывает взаимодействие с пользователем, запросы разрешений и наблюдает за состоянием ViewModel. Он обновляет UI на основе изменений в bluetoothState LiveData, предоставляемом ViewModel.

## Запуск приложения

Для запуска приложения следуйте инструкциям по настройке и подключению вашего устройства к Bluetooth HC-05. Убедитесь, что все необходимые разрешения предоставлены, и используйте правильный MAC-адрес вашего устройства.
